# strategy_gemini_integration.py - Analysis Engine ëª¨ë“ˆ
# ì—­í• : Analysis Engine ê´€ë ¨ ê¸°ëŠ¥ ì œê³µ

```python
"""
íˆ¬ì ëŒ€ê°€ ì „ëµ + Gemini AI í†µí•© ì‹œìŠ¤í…œ
ëª¨ë“  íˆ¬ì ëŒ€ê°€ ì „ëµì˜ ê²°ê³¼ë¥¼ Gemini AIê°€ ê³ í’ˆì§ˆ ë°ì´í„°ë¡œ ìµœì¢… ë¶„ì„
"""
import asyncio
from typing import Dict, List, Optional, Any
from dataclasses import dataclass
from datetime import datetime
import pandas as pd
from loguru import logger

from .gemini_premium_data_processor import GeminiPremiumDataProcessor, ProcessedData
from .investment_strategies import InvestmentStrategies
from ..core.base_interfaces import (
    StockData, 
    InvestmentRecommendation, 
    MarketType,
    StrategyType
)

@dataclass
class StrategyGeminiResult:
    """ì „ëµ + Gemini AI í†µí•© ê²°ê³¼"""
    symbol: str
    strategy_name: str
    strategy_score: float
    gemini_analysis: Dict[str, Any]
    final_recommendation: str
    confidence_score: float
    reasoning: str
    timestamp: datetime

@dataclass
class FinalTop5Selection:
    """ìµœì¢… Top5 ì„ ì • ê²°ê³¼"""
    market_type: MarketType
    selected_stocks: List[StrategyGeminiResult]
    selection_reasoning: str
    market_overview: str
    risk_assessment: str
    portfolio_allocation: Dict[str, float]
    gemini_master_analysis: str
    timestamp: datetime

class StrategyGeminiIntegration:
    """íˆ¬ì ì „ëµ + Gemini AI í†µí•© ì‹œìŠ¤í…œ"""
    
    def __init__(self):
        """ì´ˆê¸°í™”"""
        self.gemini_processor = GeminiPremiumDataProcessor()
        self.investment_strategies = InvestmentStrategies()
        logger.info("íˆ¬ì ì „ëµ + Gemini AI í†µí•© ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ")
    
    async def analyze_market_with_all_strategies(
        self, 
        market_type: MarketType,
        symbols: List[str]
    ) -> FinalTop5Selection:
        """ëª¨ë“  íˆ¬ì ëŒ€ê°€ ì „ëµìœ¼ë¡œ ì‹œì¥ ë¶„ì„ í›„ Gemini AI ìµœì¢… ì„ ì •"""
        
        logger.info(f"ğŸš€ {market_type.value} ì‹œì¥ ì „ì²´ ì „ëµ ë¶„ì„ ì‹œì‘ (ì¢…ëª© {len(symbols)}ê°œ)")
        
        # 1ë‹¨ê³„: ëª¨ë“  ì „ëµìœ¼ë¡œ ë¶„ì„
        strategy_results = await self._analyze_with_all_strategies(market_type, symbols)
        
        # 2ë‹¨ê³„: ê° ì¢…ëª©ë³„ Gemini AI ë¶„ì„
        gemini_results = await self._analyze_with_gemini(strategy_results)
        
        # 3ë‹¨ê³„: Gemini AI ìµœì¢… Top5 ì„ ì •
        final_selection = await self._gemini_final_selection(market_type, gemini_results)
        
        logger.info(f"âœ… {market_type.value} ì‹œì¥ ë¶„ì„ ì™„ë£Œ - Top5 ì„ ì •")
        return final_selection
    
    # ... (ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ë™ì¼)
```
