# unified_data_collector.py - Core Module ëª¨ë“ˆ
# ì—­í• : Core Module ê´€ë ¨ ê¸°ëŠ¥ ì œê³µ

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ğŸ’¾ í†µí•© ë°ì´í„° ìˆ˜ì§‘ê¸° (ê³¼ê±° ë°ì´í„° ìµœëŒ€ì¹˜)
==============================================

íŒŒì¼ëª…: modules/unified_data_collector.py
ì—­í• : ë°±í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ëª¨ë“  ê³¼ê±° ë°ì´í„°ë¥¼ í˜„ì‹¤ì ìœ¼ë¡œ ê°€ëŠ¥í•œ ìµœëŒ€ì¹˜ë¡œ ìˆ˜ì§‘, ì •ì œ, ê²°í•©í•©ë‹ˆë‹¤.
- ê³„ì¸µì  ë°ì´í„° ê²°í•©: yfinance (ì¥ê¸°) + KIS API (ë‹¨ê¸°/ì •í™•ë„) + DART (ì¬ë¬´) + FRED (ê±°ì‹œ)
- ë°ì´í„° í´ë¦¬ë‹ ë° ì „ì²˜ë¦¬
- ìµœì¢… ë¶„ì„ìš© ë°ì´í„°í”„ë ˆì„ ìƒì„±
"""

import logging
import pandas as pd
import yfinance as yf
from pandas_datareader import data as pdr
from datetime import datetime
from typing import List, Optional

# (ì‹¤ì œ êµ¬í˜„ ì‹œ KIS, DART API í´ë¼ì´ì–¸íŠ¸ í•„ìš”)
# from .kis_api import KISAPIClient
# from .dart_api import DARTAPIClient

logger = logging.getLogger(__name__)


class UnifiedDataCollector:
    """
    ë‹¤ì–‘í•œ ì†ŒìŠ¤ë¡œë¶€í„° ê³¼ê±° ë°ì´í„°ë¥¼ ìˆ˜ì§‘, ì •ì œ, ê²°í•©í•˜ì—¬
    ë°±í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©í•  ìµœì¢… ë°ì´í„°ì…‹ì„ ìƒì„±í•˜ëŠ” í´ë˜ìŠ¤.
    """

    def __init__(self, start_date: str = "1990-01-01"):
        self.start_date = pd.to_datetime(start_date)
        self.end_date = pd.to_datetime(datetime.now().strftime("%Y-%m-%d"))

        # (ì‹¤ì œ ì‚¬ìš© ì‹œ API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”)
        # self.kis_client = KISAPIClient()
        # self.dart_client = DARTAPIClient()

        yf.pdr_override()  # pandas-datareaderì™€ yfinance ì—°ë™
        logger.info(f"í†µí•© ë°ì´í„° ìˆ˜ì§‘ê¸° ì´ˆê¸°í™” ì™„ë£Œ (ì‹œì‘ì¼: {self.start_date})")

    def get_full_historical_data(self,
                                 symbol_map: dict,
                                 fred_symbols: Optional[List[str]] = None) -> pd.DataFrame:
        """
        í•œ ì¢…ëª©ì— ëŒ€í•œ ëª¨ë“  ê³¼ê±° ë°ì´í„°ë¥¼ ìµœëŒ€ì¹˜ë¡œ ìˆ˜ì§‘í•˜ê³  ê²°í•©í•©ë‹ˆë‹¤.

        Args:
            symbol_map (dict): ê° APIì—ì„œ ì‚¬ìš©í•  ì¢…ëª© ì½”ë“œ ë§µ.
                               (ì˜ˆ: {'yfinance': '005930.KS', 'kis': '005930', 'dart': '00126380'})
            fred_symbols (Optional[List[str]]): ìˆ˜ì§‘í•  FRED ê±°ì‹œ ê²½ì œ ì§€í‘œ ì½”ë“œ ë¦¬ìŠ¤íŠ¸.

        Returns:
            pd.DataFrame: ëª¨ë“  ë°ì´í„°ê°€ ê²°í•©ë˜ê³  ì „ì²˜ë¦¬ëœ ìµœì¢… ë°ì´í„°í”„ë ˆì„.
        """
        logger.info(f"'{symbol_map.get('yfinance', 'N/A')}'ì— ëŒ€í•œ ìµœëŒ€ ê³¼ê±° ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘...")

        # 1. yfinanceë¡œ ì¥ê¸° ê°€ê²© ë°ì´í„° ìˆ˜ì§‘ (ê¸°ë³¸ ë¼ˆëŒ€)
        price_df = self._get_yfinance_data(symbol_map.get('yfinance'))
        if price_df.empty:
            logger.error("yfinance ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨. í”„ë¡œì„¸ìŠ¤ë¥¼ ì¤‘ë‹¨í•©ë‹ˆë‹¤.")
            return pd.DataFrame()

        # ... (ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ë™ì¼)

    def _get_yfinance_data(self, symbol: str) -> pd.DataFrame:
        try:
            return pdr.get_data_yahoo(symbol, self.start_date, self.end_date)
        except Exception as e:
            logger.error(f"yfinance ë°ì´í„° ìˆ˜ì§‘ ì˜¤ë¥˜: {e}")
            return pd.DataFrame()
```