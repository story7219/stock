# test_enhanced_system.py - Test ëª¨ë“ˆ
# ì—­í• : Test ê´€ë ¨ ê¸°ëŠ¥ ì œê³µ


"""
ê³ ê¸‰ ì‹œìŠ¤í…œ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
"""

import asyncio
import logging
import sqlite3

# ë¡œê¹… ì„¤ì •
logging.basicConfig(level=logging.INFO,
                    format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)


async def test_enhanced_system():
    """ê³ ê¸‰ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸"""
    print("ğŸš€ ê³ ê¸‰ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘")

    try:
        # 1. ê³ ê¸‰ ê°ì •ë¶„ì„ í…ŒìŠ¤íŠ¸
        print("\n1ï¸âƒ£ ê³ ê¸‰ ê°ì •ë¶„ì„ í…ŒìŠ¤íŠ¸")
        from modules.advanced_sentiment_analyzer import (
            AdvancedSentimentAnalyzer
        )
        analyzer = AdvancedSentimentAnalyzer()

        # í•œêµ­ì–´ í…ŒìŠ¤íŠ¸
        korean_result = analyzer.analyze_sentiment(
            "ì‚¼ì„±ì „ì ì£¼ê°€ ìƒìŠ¹ì„¸, ê¸ì •ì ì¸ ì‹¤ì  ë°œí‘œ", "korean"
        )
        print(f"ğŸ‡°ğŸ‡· í•œêµ­ì–´: {korean_result.sentiment_score:.3f}")

        # ì˜ì–´ í…ŒìŠ¤íŠ¸
        english_result = analyzer.analyze_sentiment(
            "Apple stock surges on positive earnings", "english"
        )
        print(f"ğŸ‡ºğŸ‡¸ ì˜ì–´: {english_result.sentiment_score:.3f}")

        # 2. ê³ ê¸‰ ë°ì´í„° ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸
        print("\n2ï¸âƒ£ ê³ ê¸‰ ë°ì´í„° ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸")
        from data.enhanced_data_collector import (
            EnhancedDataCollector
        )
        collector = EnhancedDataCollector()

        # ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” í™•ì¸
        with sqlite3.connect(collector.db_path) as conn:
            cursor = conn.cursor()
            cursor.execute(
                "SELECT name FROM sqlite_master WHERE type='table'"
            )
            tables = cursor.fetchall()
            print(f"ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”: {len(tables)}ê°œ")

        # 3. ê³ ê¸‰ í†µí•© ë¶„ì„ í…ŒìŠ¤íŠ¸ (ê°„ë‹¨ ë²„ì „)
        print("\n3ï¸âƒ£ ê³ ê¸‰ í†µí•© ë¶„ì„ í…ŒìŠ¤íŠ¸")
        from analysis.enhanced_unified_analyzer import (
            EnhancedUnifiedAnalyzer
        )
        unified_analyzer = EnhancedUnifiedAnalyzer()

        # ê¸°ë³¸ ë¶„ì„ í…ŒìŠ¤íŠ¸
        print("âœ… ê³ ê¸‰ í†µí•© ë¶„ì„ê¸° ì´ˆê¸°í™” ì™„ë£Œ")

        print("\nâœ… í•µì‹¬ ê³ ê¸‰ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!")

    except Exception as e:
        print(f"âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}")
        logger.error(f"í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: {e}")


if __name__ == "__main__":
    asyncio.run(test_enhanced_system())

