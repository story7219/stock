
"""
ğŸ§ª ë©”ì¸ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
================================================================
íŒŒì¼ëª…: test_main.py
ì—­í• : ë©”ì¸ ì‹œìŠ¤í…œì˜ ê¸°ë³¸ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
"""

import asyncio
import logging
import sys
from pathlib import Path
from modules.unified_signal_generator import (
    UnifiedSignalGenerator, SignalWeights
)


# ë¡œê¹… ì„¤ì •
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s | %(levelname)-8s | %(name)-20s | %(message)s'
)
logger = logging.getLogger(__name__)


async def test_basic_functionality():
    """ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸"""
    try:
        logger.info("ğŸ§ª ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘")

        # 1. ëª¨ë“ˆ ì„í¬íŠ¸ í…ŒìŠ¤íŠ¸
        logger.info("ğŸ“¦ ëª¨ë“ˆ ì„í¬íŠ¸ í…ŒìŠ¤íŠ¸")
        try:
            from modules.unified_signal_generator import (
                UnifiedSignalGenerator, SignalWeights
            )
            logger.info("âœ… unified_signal_generator ëª¨ë“ˆ ì„í¬íŠ¸ ì„±ê³µ")
        except ImportError as e:
            logger.warning(
                f"âš ï¸ unified_signal_generator ëª¨ë“ˆ ì„í¬íŠ¸ ì‹¤íŒ¨: {e}"
            )

        # 2. ì„¤ì • íŒŒì¼ í…ŒìŠ¤íŠ¸
        logger.info("âš™ï¸ ì„¤ì • íŒŒì¼ í…ŒìŠ¤íŠ¸")
        config_path = Path("configs/unified_config.yaml")
        if config_path.exists():
            logger.info("âœ… ì„¤ì • íŒŒì¼ ì¡´ì¬ í™•ì¸")
        else:
            logger.warning("âš ï¸ ì„¤ì • íŒŒì¼ ì—†ìŒ")

        # 3. ë””ë ‰í† ë¦¬ ìƒì„± í…ŒìŠ¤íŠ¸
        logger.info("ğŸ“ ë””ë ‰í† ë¦¬ ìƒì„± í…ŒìŠ¤íŠ¸")
        directories = ["logs", "results", "trades", "test_results"]
        for dir_name in directories:
            Path(dir_name).mkdir(exist_ok=True)
            logger.info(f"âœ… {dir_name} ë””ë ‰í† ë¦¬ ìƒì„±/í™•ì¸")

        # 4. ê°„ë‹¨í•œ ì‹ í˜¸ ìƒì„± í…ŒìŠ¤íŠ¸
        logger.info("ğŸš€ ê°„ë‹¨í•œ ì‹ í˜¸ ìƒì„± í…ŒìŠ¤íŠ¸")
        try:
            config = {
                'ml_weight': 0.4,
                'dl_weight': 0.3,
                'gemini_weight': 0.3,
                'threshold': 0.6,
                'min_confidence': 0.5
            }

            generator = UnifiedSignalGenerator(config)

            # í…ŒìŠ¤íŠ¸ ë°ì´í„°
            test_data = {
                # ... (ì´ì „ ì½”ë“œ)
            }
            # ì‹ í˜¸ ìƒì„±
            result = await generator.generate_unified_signal(
                symbol="AAPL",
                technical_data=test_data['technical'],
                news=test_data['news'],
                financial_data=test_data['financial']
            )
            # ... (ì´ì „ ì½”ë“œ)

        except Exception as e:
            logger.error(f"âŒ ì‹ í˜¸ ìƒì„± í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}")

        logger.info("ğŸ‰ ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!")

    except Exception as e:
        logger.error(f"âŒ ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}")
        raise


async def main():
    """ë©”ì¸ í•¨ìˆ˜"""
    try:
        await test_basic_functionality()
    except KeyboardInterrupt:
        logger.info("ğŸ‘‹ ì‚¬ìš©ìì— ì˜í•´ í…ŒìŠ¤íŠ¸ ì¤‘ë‹¨")
    except Exception as e:
        logger.error(f"âŒ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹¤íŒ¨: {e}")
        sys.exit(1)


if __name__ == "__main__":
    asyncio.run(main())
    