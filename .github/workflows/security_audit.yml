name: "ğŸ”’ ë³´ì•ˆ ê°ì‚¬"

on:
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰

jobs:
  security_audit:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ Python í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: ğŸ“¦ ë³´ì•ˆ ë„êµ¬ ì„¤ì¹˜
        run: |
          pip install --upgrade pip
          pip install bandit safety
          pip install -r requirements.txt

      - name: ğŸ” ë³´ì•ˆ ê°ì‚¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
        run: |
          python security_auditor.py
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

      - name: ğŸ›¡ï¸ Python ë³´ì•ˆ ì·¨ì•½ì  ê²€ì‚¬ (Bandit)
        run: |
          echo "âœ… Bandit ê²€ì‚¬ëŠ” security_auditor.pyì—ì„œ í†µí•© ì²˜ë¦¬ë©ë‹ˆë‹¤"

      - name: ğŸ“š ì˜ì¡´ì„± ì·¨ì•½ì  ê²€ì‚¬ (Safety)
        run: |
          echo "âœ… Safety ê²€ì‚¬ëŠ” security_auditor.pyì—ì„œ í†µí•© ì²˜ë¦¬ë©ë‹ˆë‹¤"

      - name: ğŸ”§ í™˜ê²½ ì„¤ì • ë³´ì•ˆ ê²€ì‚¬
        run: |
          echo "âœ… í™˜ê²½ ì„¤ì • ê²€ì‚¬ëŠ” security_auditor.pyì—ì„œ í†µí•© ì²˜ë¦¬ë©ë‹ˆë‹¤"
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

      - name: ğŸ“± ë³´ì•ˆ ë¦¬í¬íŠ¸ ì „ì†¡
        if: success()
        run: |
          python -c "
          import requests
          import os
          from datetime import datetime
          
          bot_token = os.environ.get('TELEGRAM_BOT_TOKEN')
          chat_id = os.environ.get('TELEGRAM_CHAT_ID')
          
          if bot_token and chat_id and bot_token != 'test_telegram_token':
              message = f'''ğŸ”’ ë³´ì•ˆ ê°ì‚¬ ì™„ë£Œ!
              
              ğŸ“… ê²€ì‚¬ì¼: {datetime.now().strftime('%Y-%m-%d %H:%M')}
              
              âœ… API í‚¤ ë…¸ì¶œ ê²€ì‚¬ ì™„ë£Œ
              âœ… Python ë³´ì•ˆ ì·¨ì•½ì  ê²€ì‚¬ ì™„ë£Œ  
              âœ… ì˜ì¡´ì„± ì·¨ì•½ì  ê²€ì‚¬ ì™„ë£Œ
              âœ… í™˜ê²½ ì„¤ì • ë³´ì•ˆ ê²€ì‚¬ ì™„ë£Œ
              
              ğŸ›¡ï¸ ì‹œìŠ¤í…œ ë³´ì•ˆì´ ì–‘í˜¸í•©ë‹ˆë‹¤.'''
              
              try:
                  requests.post(
                      f'https://api.telegram.org/bot{bot_token}/sendMessage',
                      json={'chat_id': chat_id, 'text': message}
                  )
                  print('âœ… ë³´ì•ˆ ë¦¬í¬íŠ¸ ì „ì†¡ ì™„ë£Œ')
              except Exception as e:
                  print(f'âš ï¸ í…”ë ˆê·¸ë¨ ì „ì†¡ ì‹¤íŒ¨: {e}')
          else:
              print('âœ… ë³´ì•ˆ ê°ì‚¬ ì™„ë£Œ (í…ŒìŠ¤íŠ¸ ëª¨ë“œ)')
          "
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

      - name: ğŸ“± ë³´ì•ˆ ê²½ê³  ì•Œë¦¼
        if: failure()
        run: |
          python -c "
          import requests
          import os
          from datetime import datetime
          
          bot_token = os.environ.get('TELEGRAM_BOT_TOKEN')
          chat_id = os.environ.get('TELEGRAM_CHAT_ID')
          
          if bot_token and chat_id and bot_token != 'test_telegram_token':
              message = f'''ğŸš¨ ë³´ì•ˆ ê°ì‚¬ ê²½ê³ !
              
              âš ï¸ ë³´ì•ˆ ê²€ì‚¬ ì¤‘ ë¬¸ì œê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.
              ğŸ“… {datetime.now().strftime('%Y-%m-%d %H:%M')}
              
              ì¦‰ì‹œ ì ê²€ì´ í•„ìš”í•©ë‹ˆë‹¤.
              GitHub Actions ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.'''
              
              try:
                  requests.post(
                      f'https://api.telegram.org/bot{bot_token}/sendMessage',
                      json={'chat_id': chat_id, 'text': message}
                  )
              except:
                  pass
          print('ğŸš¨ ë³´ì•ˆ ê²½ê³  ë°œìƒ')
          "
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }} 