name: "ğŸš€ ì²™í›„ë³‘ ì „ëµ ê´€ë¦¬ ì‹œìŠ¤í…œ"

on:
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰

jobs:
  scout_trading:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ Python í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ğŸš€ ì²™í›„ë³‘ ì „ëµ ê´€ë¦¬ ì‹œìŠ¤í…œ ì‹¤í–‰
        run: python scout_strategy_manager.py run
        env:
          # GitHub Repository Secretsì—ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
          # ì„¤ì • ë°©ë²•: ë¦¬í¬ì§€í† ë¦¬ > Settings > Secrets and variables > Actions
          IS_MOCK: ${{ secrets.IS_MOCK }}
          KIS_APP_KEY: ${{ secrets.KIS_APP_KEY }}
          KIS_APP_SECRET: ${{ secrets.KIS_APP_SECRET }}
          KIS_ACCOUNT_NO: ${{ secrets.KIS_ACCOUNT_NO }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

      - name: ğŸ“± ì„±ê³µ ì•Œë¦¼
        if: success()
        run: |
          python -c "
          import requests, os
          bot_token = os.environ.get('TELEGRAM_BOT_TOKEN')
          chat_id = os.environ.get('TELEGRAM_CHAT_ID')
          if bot_token and chat_id and bot_token != 'test_telegram_token':
              message = 'âœ… ì²™í›„ë³‘ ì‹œìŠ¤í…œ ìë™ ì‹¤í–‰ ì„±ê³µ!\\n\\nGitHub Actionsì—ì„œ ë§¤ë§¤ ì‚¬ì´í´ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'
              requests.post(f'https://api.telegram.org/bot{bot_token}/sendMessage', 
                          json={'chat_id': chat_id, 'text': message})
          "
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

      - name: ğŸ“± ì‹¤íŒ¨ ì•Œë¦¼
        if: failure()
        run: |
          python -c "
          import requests, os
          bot_token = os.environ.get('TELEGRAM_BOT_TOKEN')
          chat_id = os.environ.get('TELEGRAM_CHAT_ID')
          if bot_token and chat_id and bot_token != 'test_telegram_token':
              message = 'âŒ ì²™í›„ë³‘ ì‹œìŠ¤í…œ ìë™ ì‹¤í–‰ ì‹¤íŒ¨!\\n\\nGitHub Actionsì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.'
              requests.post(f'https://api.telegram.org/bot{bot_token}/sendMessage', 
                          json={'chat_id': chat_id, 'text': message})
          "
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }} 