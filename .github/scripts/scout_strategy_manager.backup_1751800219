# scout_strategy_manager.py - Analysis Engine ëª¨ë“ˆ
# ì—­í• : Analysis Engine ê´€ë ¨ ê¸°ëŠ¥ ì œê³µ

```python
"""
ğŸš€ ì²™í›„ë³‘ ì „ëµ ê´€ë¦¬ ì‹œìŠ¤í…œ
íˆ¬ì ëŒ€ê°€ë“¤ì˜ ì „ëµì„ í™œìš©í•œ ìë™ ë§¤ë§¤ ì‹œìŠ¤í…œ
"""

import os
import sys
import asyncio
import logging
from datetime import datetime
from typing import Dict, List, Any
import requests

# ë¡œê¹… ì„¤ì •
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

class ScoutStrategyManager:
    """ì²™í›„ë³‘ ì „ëµ ê´€ë¦¬ì"""
    
    def __init__(self) -> None:
        self.is_mock: bool = os.getenv('IS_MOCK', 'True').lower() == 'true'
        self.kis_app_key: str = os.getenv('KIS_APP_KEY')
        self.kis_app_secret: str = os.getenv('KIS_APP_SECRET')
        self.kis_account_no: str = os.getenv('KIS_ACCOUNT_NO')
        self.telegram_bot_token: str = os.getenv('TELEGRAM_BOT_TOKEN')
        self.telegram_chat_id: str = os.getenv('TELEGRAM_CHAT_ID')
        
        logger.info(f"ğŸš€ ì²™í›„ë³‘ ì‹œìŠ¤í…œ ì´ˆê¸°í™” (Mock ëª¨ë“œ: {self.is_mock})")
    
    def validate_environment(self) -> bool:
        """í™˜ê²½ ë³€ìˆ˜ ê²€ì¦"""
        required_vars: List[str] = ['KIS_APP_KEY', 'KIS_APP_SECRET', 'KIS_ACCOUNT_NO']
        
        if not self.is_mock:
            for var in required_vars:
                if not os.getenv(var):
                    logger.error(f"âŒ í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ ëˆ„ë½: {var}")
                    return False
        
        logger.info("âœ… í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ ì™„ë£Œ")
        return True
    
    # ... (ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ë™ì¼)
    
    async def run_trading_cycle(self) -> Dict[str, Any]:
        """ë§¤ë§¤ ì‚¬ì´í´ ì‹¤í–‰"""
        logger.info("ğŸ”„ ë§¤ë§¤ ì‚¬ì´í´ ì‹œì‘")
        
        try:
            # 1. ì‹œì¥ ë¶„ì„
            market_analysis = await self.analyze_market_conditions()
            
            # 2. ì¶”ì²œ ì „ëµ ì‹¤í–‰
            results: List[Dict[str, Any]] = []
            for strategy in market_analysis['recommended_strategies']:
                result = await self.execute_scout_strategy(strategy)
                results.append(result)
            
            # 3. ê²°ê³¼ ì§‘ê³„
            cycle_result: Dict[str, Any] = {
                'timestamp': datetime.now().isoformat(),
                'market_analysis': market_analysis,
                'strategy_results': results,
                'total_strategies': len(results),
                'successful_strategies': len([r for r in results if r['status'] == 'success']),
                'status': 'completed'
            }
            
            # 4. ì•Œë¦¼ ì „ì†¡
            notification_message = f"""ğŸš€ **ì²™í›„ë³‘ ë§¤ë§¤ ì‚¬ì´í´ ì™„ë£Œ**

ğŸ“Š **ì‹œì¥ ë¶„ì„**
- íŠ¸ë Œë“œ: {market_analysis['market_trend']}
- ë³€ë™ì„±: {market_analysis['volatility']}
- ê±°ë˜ëŸ‰: {market_analysis['volume']}

ğŸ¯ **ì‹¤í–‰ëœ ì „ëµ**: {len(results)}ê°œ
âœ… **ì„±ê³µí•œ ì „ëµ**: {cycle_result['successful_strategies']}ê°œ

â° **ì‹¤í–‰ ì‹œê°„**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
"""
            await self.send_telegram_notification(notification_message)
            
            logger.info("ğŸ‰ ë§¤ë§¤ ì‚¬ì´í´ ì™„ë£Œ")
            return cycle_result
        
        except Exception as e:
            logger.error(f"âŒ ë§¤ë§¤ ì‚¬ì´í´ ì˜¤ë¥˜: {e}")
            await self.send_telegram_notification(
                f"âŒ ë§¤ë§¤ ì‚¬ì´í´ ì˜¤ë¥˜: {str(e)}"
            )
            raise
    # ... (ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ë™ì¼)
```
